@input = <<-EOM
                                                                                                                                                                             |                           
       +-------+             +---+                                         +-------------+           +-+   +---------+ +---------------------------------------------------------+ +-+     +---+         
       |       |             |   |                                         |             |           | |   |         | |                                                     |   | | |     |   |         
 +-----|-------+     +-------|-----+                                       +-------+ +-+ +-----------|-|---|---------|-----------------+ +---------------------------------------+ | +-----|---|-------+ 
 |     |             |       |   | |                                               | | |             | |   |         | |               | |                                   |     |       |   |       | 
 |     |             |       |   | |       +-----------+                         +---+ |         +---|-|-------------|-|---------------+ +---+                               |     |     +---+ |       | 
 |     |             |       |   | |       |           |                         | |   |         |   | |   |         | |                     |                               |     |     | | | |       | 
 |     |             |       |   | |       +-----------------------+             | |   |         |   | |   |         | |                     |                               |     |     | | | |       | 
 |     |             |       |   | |                   |           |             | |   |         |   | |   |         | |                     |                               |     |     | | | |       | 
 |     |             |       |   | |     +-------+     |   +-------|-----------------------------|---+ | +-|-------+ | |                   +-----+                           |     |     | | | |       | 
 |     |             |       |   | |     |       |     |   |       |             | |   |         |     | | |       | | |                   | |   |                           |     |     | | | |       | 
 |     |             |       |   | |     |       |     |   |       +-------------|-|---|---------|-------|---------|---|---------------------|---|-------+   +---------------|-----------|-+ | |       | 
 |     |             |       |   | |     |       |     |   |                     | |   |         |     | | |       | | |                   | |   |       |   |               |     |     |   | |       | 
 |     |             |       |   | |     |   +---------|-------------------------|-----|---------|---------|---------|-----------------------|---------------|-----------+   |   +-------------|-----+ | 
 |     |             |       |   | |     |   |   |     |   |                     | |   |         |     | | |       | | |                   | |   |       |   |           |   |   | |     |   | |     | | 
 |     |             |       |   +-|-------+ +-----+   |   |           +-----------|---|---------------|-----------|-+ |                   | |   |       |   |           |   |   | |     |   +-----+ | | 
 |     |             |       |     |     | |     | |   |   |           |         | |   |         |     | | |       |   |                   | |   |       |   |           |   |   | |     |     |   | | | 
 +---+ +-------------|-------------------|-+     | |   |   |           |         | |   |         |     | | |   +---|-----------------------|-|-----------------------------------|-----------+ |   | | | 
     |               |       |     |     |       | |   |   |           |         | |   |         |     | | |   |   |   |                   | |   |       |   |           |   |   | |     |   | |   | | | 
     +-+             |   +-----+ +-------|R--------|---------+         |         | |   |         +-----|---|---|-------|-----------------------------------------------+ | +-|---|-------|-+ | |   | +-+ 
       |             |   |   | | | |     |       | |   |   | |         |         | |   |               | | |   |   |   |                   | |   |       |   |         | | | |   | |     | | | |   |     
       |             | +-|-+ | | +-|-----|---+   | |   +---+ | +-----------------|-----|-------------------|-------|-------+               | |   |       |   +-------------------|-|-----|-----|-------+ 
       |             | | | | | |   |     |   |   | |         | |       |         | |   |               | | |   |   |   |   |               | |   |       |             | | | |   | |     | | | |   |   | 
       |             | | +---|-|---------|-------|-----------|-|-----------------|-|---+               | | |   |   |   |   |               | |   |   +-------+         | | | |   | |   +---|---------+ | 
       |             | |   | | |   |     |   |   | |         | |       |         | |                   | | |   |   |   |   |               | |   |   |   |   |         | | | |   | |   | | | | |   | | | 
       |             | |   | | |   |     |   |   | |         | |       |         | |   +---------------|---|-----------|---+               | |   |   |   |   |         | | | |   | |   | | | | |   | | | 
       |             | |   | | |   |     |   |   | |         | |       |         | |   |               | | |   |   |   |                   | |   |   |   |   |         | | | |   | |   | | | | |   | | | 
   +-+ | +---+       | |   | | |   |     |   |   | |     +-----|-----------------|-|---|-------+       | | |   |   |   |                   | |   |   |   |   |         | | | |   | |   | | | | |   | | | 
   | | | |   |       | |   | | |   |     |   |   | |     |   | |       |         | |   |       |       | | |   |   |   |                   | |   |   |   |   |         | | | |   | |   | | | | |   | | | 
   | | | |   |       | |   | | |   |     |   |   | |   +-|---|---------------------|-------+   |       +-|-|---|-------------------+       | |   |   |   | +-----+ +---+ | | |   | |   | | | | |   | | | 
   | | | |   |       | |   | | |   |     |   |   | |   | |   | |       |         | |   |   |   |         | |   |   |   |           |       | |   |   |   | | |   | |     | | |   | |   | | | | |   | | | 
   | +-|-------------------|---|---------|-------+ |   | | +-|---------------+   | |   |   |   |         | |   |   |   |           |       | |   |   |   | | |   | |     | | |   | |   | | | | |   | | | 
   |   | |   |       | |   | | |   |     |   |     |   | | | | |       |     |   | |   |   |   |         | |   |   |   |           |       | |   |   |   | | |   | |     | | |   | |   | | | | |   | | | 
   |   | |   |       | |   | | |   |     |   |     |   | | | | +-------|---------|---------+   |         | |   |   |   |           |       | | +-|---|-----------|-|-----|-------+ |   | | | | |   | | | 
   |   | |   |       | |   | | |   |     |   |     |   | | | |         |     |   | |   |       |         | |   |   |   |           |       | | | |   |   | | |   | |     | | |     |   | | | | |   | | | 
 +-|-+ | |   |       | |   | | |   |     |   |     |   | | | |         |     |   | |   |       |         | |   |   |   |           |       | | | |   | +-|-+ | +-|-|-------------------|---|-+ |   | | | 
 | | | | |   |       | |   | | |   |     |   |     |   | | | |         |     |   | |   |       |         | |   |   |   |           |       | | | |   | | |   | | | |     | | |     |   | | |   |   | | | 
 | | +---|-------------|---|---+   |     |   |     |   | +-+ |         |     |   | |   |       |         | |   |   |   |           |       | | | |   | | |   | | | |     | | |     |   | | |   |   | | | 
 | |   | |   |       | |   | |     |     |   |     |   |     |         |     |   | |   |       |         | |   |   |   |           |       | | | |   | | |   | | | |     | | |     |   | | |   |   | | | 
 | |   | |   |       | |   | |     |     |   |     | +-------|---------|-----|---|-|----I------------------|---+   |   |           |       | | | |   | | |   | | | |     | | |     |   | | |   |   | | | 
 | |   | |   |       | |   | |     |     |   |     | | |     |         |     |   | |   |       |         | |       |   |           |       | | | |   | | |   | | | |     | | |     |   | | |   |   | | | 
 | |   | |   |   +---|-----|-----+ |     +---|---+ | | |     |     +---|-----|---------|-----------------|---------------------------------|-|-|-----|---------|---------|-|---+   |   | | |   |   | | | 
 | |   | |   |   |   | |   | |   | |         |   | | | |     |     |   |     |   | |   |       |         | |       |   |           |       | | | |   | | |   | | | |     | | | |   |   | | |   |   | | | 
 | | +-------|---|-----|---|-----|-----------|---|-|---|---------------|-----|---------|-----------------|-|-----------|---------------------|-+ |   | | |   | | | |     | | | |   |   | | |   |   | | | 
 | | | | |   |   |   | |   | |   | |         |   | | | |     |     |   |     |   | |   |       |         | |       |   |           |       | |   |   | | |   | | | |     | | | |   |   | | |   |   | | | 
 | | | | |   |   |   | |   | |   | |         |   | | | |     |     |   |     |   | |   |       |         | |       |   |           |       | |   |   | | | +---|-|---------|-------|-+ | | |   |   | | | 
 | | | | |   |   |   | |   | |   | |         |   | | | |     |     |   |     |   | |   |       |         | |       |   |           |       | |   |   | | | | | | | |     | | | |   | | | | |   |   | | | 
 | | | | |   |   |   | |   | |   | |         |   | | | |     |     |   |     |   | |   |       |         | |       |   |           |       | |   |   | | | +-|-|-+ |     | | | |   | | | | |   |   | | | 
 | | | | |   |   |   | |   | |   | |         |   | | | |     |     |   |     |   | |   |       |         | |       |   |           |       | |   |   | | |   | |   |     | | | |   | | | | |   |   | | | 
 | | | | |   |   |   | |   | |   | |         |   | | | |     |     |   |     |   | |   |       +-----------|---------------------------------|-------+ | |   | |   |     | | | |   | | | | |   |   | | | 
 | | | | |   |   |   | |   | |   | |         |   | | | |     |     |   |     |   | |   |                 | |       |   |           |       | |   |     | |   | |   |     | | | |   | | | | |   |   | | | 
 | +-|-|---------------|-----|-----|---------|-------|-----------------------|---------|-----------------|-|-------|---------------|-------------------|-+   | |   |     | | | |   | | | | |   |   | | | 
 |   | | |   |   |   | |   | |   | |         |   | | | |     |     |   |     |   | |   |                 | |       |   |           |       | |   |     |     | |   |     | | | |   | | | | |   |   | | | 
 |   | | |   |   | +---------|---+ |         +-----|-|-----------------|-----|---------------------------|-|-----------------------|---------|---|-----|-----|---+ |     | | | |   | | | | |   |   | | | 
 |   | | |   |   | | | |   | |     |             | | | |     |     |   |     |   | |   |                 | |       |   |           |       | |   |     |     | | | |     | | | |   | | | | |   |   | | | 
 |   | | |   |   | | | |   | |     |             | | | |     |     |   |     |   | |   |                 | |       |   |           |       +-|---|-----------|-----------------|-----------|-----+ | | | 
 |   | | |   |   | | | |   | |     |             | | | |     |     |   |     |   | |   |                 | |       |   |           |         |   |     |     | | | |     | | | |   | | | | |   | | | | | 
 |   | | |   |   | | | |   +-|-------+           | | | |     |     |   |     |   | |   |                 | |       |   |           |         |   |     |     | | | |     | | | |   | | | | |   | | | | | 
 |   | | |   |   | | | |     |     | |           | | | |     |     |   |     |   | |   |                 | |       |   |           |         |   |     |     | | | |     | | | |   | | | | |   | | | | | 
 |   +--C----|-------|-------|-----|-|-----------|-|-|-+     |     |   |     |   | |   |         +---------|-------|-----------------------------------|-----|-|-|-|-+   | | | |   | | | | |   | | | | | 
 |     | |   |   | | | |     |     | |           | | |       |     |   |     |   | |   |         |       | |       |   |           |         |   |     |     | | | | |   | | | |   | | | | |   | | | | | 
 |     +-|---|-------|-|-----|-----|-------------|-|---+     |     |   |     |   | |   |         |       | |       |   |           |         |   |   +-|-----|---|-|-|---|---------|-----|-+   | | | | | 
 |       |   |   | | | |     |     | |           | | | |     |     |   |     |   | |   |         |       | |       |   |           |         |   |   | |     | | | | |   | | | |   | | | |     | | | | | 
 |       |   |   | | | |     |     | |         +-|-|---|-----------|-------------|-|---|-----------------|---------|---------------|-----------------|-|---------|-+ |   | | | |   | | | |     | | | | | 
 |       |   |   | | | |     |     | |         | | | | |     |     |   |     |   | |   |         |       | |       |   |           |         |   |   | |     | | |   |   | | | |   | | | |     | | | | | 
 |       |   |   | | | |     |     | |         | | | | |     |     |   |     |   | |   |         |       | |       |   |           | +-----------|-----|-----|-----------+ | | |   | | | |     | | | | | 
 |       |   |   | | | |     |     | |         | | | | |     |     |   |     |   | |   |         |       | |       |   |           | |       |   |   | |     | | |   |     | | |   | | | |     | | | | | 
 |       |   |   | | | |     |     | |         | | | | |     |     |   |     |   | |   |         |       | |       |   |           | |       |   |   | |     | | |   |     | | |   | | | |     | | | | | 
 |       |   |   | | | |     |     | |         | | | | |     |     |   |     |   | |   |         |       | |       |   |           | |       |   |   | |     | | |   |     | | |   | | | |     | | | | | 
 |       |   |   | | | |     |     | |         | | | | |     |     |   |     |   | |   |         |       | |       |   |           | |       |   |   | |     | | |   |     | | |   | | | |     | | | | | 
 |       |   |   | | | |     |     | |         | | | | |     |     |   |     |   | |   |         |       | |       |   |           | |       |   |   | |     | | |   |     | | |   | | | |     | | | | | 
 +-----------|-------|-|-------------|---------|-------------------|---|---------|-----|-----------------------+ +-|-------------------------|---|---|-----------|-+ |     | | |   | | | |     | | | | | 
         |   |   | | | |     |     | |         | | | | |     |     |   |     |   | |   |         |       | |   | | |   |           | |       |   |   | |     | | | | |     | | |   | | | |     | | | | | 
 +---------------------|-----|-----------------|-|-|-|-------|-----------+   +---------------------------|-+   | | |   |           +---------|---|---|-|-----|-|---+ +---------|---|-|-|-|---+ | | | | | 
 |       |   |   | | | |     |     | |         | | | | |     |     |   | |       | |   |         |       |     | | |   |             |       |   |   | |     | | |         | | |   | | | |   | | | | | | 
 |       |   |   | | | |     |   +---|---------|---|-|-------------|---|-|-------------|-----------------------|-------|-------------|-------|-------------------|---------|-|-+   | | | |   | | | | | | 
 |       |   |   | | | |     |   | | |         | | | | |     |     |   | |       | |   |         |       |     | | |   |             |       |   |   | |     | | |         | |     | | | |   | | | | | | 
 | +-----------+ | | | |     |   | | |         | | | | |     |     |   +---------|-----|-------------------------|-------------------------+ |   |   | |     | | |         | +-+   | | | |   | | | | | | 
 | |     |   | | | | | |     |   | | |         | | | | |     |     |     |       | |   |         |       |     | | |   |             |     | |   |   | |     | | |         |   |   | | | |   | | | | | | 
 | |     |   | | | | | |     |   | +-------------|-|-|-----------------------------|-------------|---------+   | | |   |             |     +-|---|-----|-------------------|---------|-|-----|-----+ | | 
 | |     |   | | | | | |     |   |   |         | | | | |     |     |     |       | |   |         |       | |   | | |   |             |       |   |   | |     | | |         |   |   | | | |   | | |   | | 
 | |     |   | | | | | |     |   +-------------|---|---|-----|-----|-----|-----+ | |   |         |       | | +-+ | |   |             |       |   |   | |     | | |         |   |   | | | |   | | |   | | 
 | |     |   | | | | | |     |       |         | | | | |     |     |     |     | | |   |         |       | | |   | |   |             |       |   |   | |     | | |         |   |   | | | |   | | |   | | 
 | |     |   | | | | | |     |       |         | | | | |     |     |     |     | | |   |         |     +---|-------------------------------------------------|-|-|---------|-------|-+ | |   | | |   | | 
 | |     |   | | | | | |     |       |         | | | | |     |     |     |     | | |   |         |     | | | |   | |   |             |       |   |   | |     | | |         |   |   |   | |   | | |   | | 
 | |   +-------|---|-------------+   |         +-|---+ |     |     |     |     | | |   | +-------------|---------|-----|-------------------------|---|-------|-|-|---+     |   |   |   | |   | | |   | | 
 | |   | |   | | | | | |     |   |   |           | |   |     |     |     |     | | |   | |       |     | | | |   | |   |             |       |   |   | |     | | |   |     |   |   |   | |   | | |   | | 
 | | +---|---|-|-|-|-|-|-----|-------|-------------|---|-----------------|-----|-------|-|-------------|-|-|-----|-|-----------------|-------|---|-----+     +-|-|---------|---|-------|---------|-+ | | 
 | | | | |   | | | | | |     |   |   |           | |   |     |     |     |     | | |   | |       |     | | | |   | |   |             |       |   |   |         | |   |     |   |   |   | |   | | | | | | 
 | | | | |   | | | | | |     |   +---|-----------|-|---------------------------|-|-----|-|---------------|-|-|-----|---+             |       |   |   |         | |   |     |   |   |   | |   | | | | | | 
 | | | | |   | | | | | |     |       |           | |   |     |     |     |     | | |   | |       |     | | | |   | |                 |       |   |   |         | |   |     |   |   |   | |   | | | O | | 
 | | | | | +-|---|-------------------|-----------|-----|-----|-----|---------+ | | |   | |       |     | | | |   | |   +---------+   |       |   |   |         | |   |     |   |   |   | |   | | | | | | 
 | | | | | | | | | | | |     |       |           | |   |     |     |     |   | | | |   | |       |     | | | |   | |   |         |   |       |   |   |         | |   |     |   |   |   | |   | | | | | | 
 +-+ | | | | | | | | | |     |       |           | |   |     |     |     |   | | | |   | |       |     | | +-|---------|---------------------|---|---|---------|-|---|-----|---|-------|------Q--|---+ | 
     | | | | | | | | | |     |       |           | |   |     |     |     |   | | | |   | |       |     | |   |   | |   |         |   |       |   |   |         | |   |     |   |   |   | |   | | | |   | 
 +-------------|-|---+ |     |       |           | |   |     |     |     |   | | | |   | |       |     | |   |   | |   +-------------|---------------+         | |   |     |   +---|---|-|---|-----|-+ | 
 |   | | | | | | | |   |     |       |           | |   |     |     |     |   | | | |   | |       |     | |   |   | |             |   |       |   |             | |   |     |       |   | |   | | | | | | 
 |   | | | | | | | |   |     |       |           | |   |     |     |     |   | | | |   | |       |     | |   |   | |             |   |       |   |         +---|-|-------------+   |   | |   | | | | | | 
 |   | | | | | | | |   |     |       |           | |   |     |     |     |   | Y | |   | |       |     | |   |   | |             |   |       P   |         |   | |   |     |   |   |   | |   | | | | | | 
 |   | | | | | | | |   |     |       |           | |   |     |     |     |   | | | |   | |       |     | |   |   | |         +-------|-------|---|-------+ |   | |   |     |   +-----+ | |   | | | | | | 
 |   | | | | | | | |   |     |       |           | |   |     |     |     |   | | | |   | |       |     | |   |   | |         |   |   |       |   |       | |   | |   |     |       | | | |   | | | | | | 
 |   | | | | | | | |   |     |       |           | |   |     |     |     |   | | | |   | |       |     | |   |   | |         |   |   |       |   |       | |   | |   |     |       | | | |   | | | | | | 
 |   | | | | | | | |   |     |       |           | |   |     |     |     |   | | | |   | |       |     | |   |   | |         |   |   |       |   |       | |   | |   |     |       | | | |   | | | | | | 
 |   | | | | | | | |   |     |       |           | |   |     |     |     |   | | | |   | |       |     | |   |   | |         |   |   |       |   |       | |   | |   |     |       | | | |   | | | | | | 
 |   | | | | | | | |   |     |       |           | |   |     |     |     |   | | | |   | |       |     | |   |   | |         |   |   |       |   |       | |   | |   |     |       | | | |   | | | | | | 
 |   | | | | | | | |   |     |       |           | |   |     | +---------|---|---------|-----------------|---|-------------------|---|-----------|-------|-+   | |   |     |       | | | |   | | | | | | 
 |   | | | | | | | |   |     |       |           | |   |     | |   |     |   | | | |   | |       |     | |   |   | |         |   |   |       |   |       |     | |   |     |       | | | |   | | | | | | 
 |   | | | | | | | |   |     |       |           | |   |     | |   |     |   | | | |   | |       |     | |   |   | |         |   |   |       |   |       |     | |   |     |       | | | |   | | | | | | 
 |   | | | | | | | |   |     |       |           | |   |     | |   |     |   | | | |   | |       |     | |   |   | |         |   |   |       |   |       |     | |   |     |       | | | |   | | | | | | 
 |   | | | | | | | |   |     |       |           | +---|-----|-----|-------------|-|-----|-------|-----|-----|---|---------+ |   |   |       |   |       |     | |   |     |       | | | |   | | | | | | 
 |   | | | | | | | |   |     |       |           |     |     | |   |     |   | | | |   | |       |     | |   |   | |       | |   |   |       |   |       |     | |   |     |       | | | |   | | | | | | 
 +---|-|-|-|-|---|-|-+ |     |       |           |     |     | |   |     |   | | | |   | |       |     | |   |   | |   +---|-+   +---|-------|---|-------------------|-------+     | | | |   | | | | | | 
     | | | | | | | | | |     |       |           |     |     | |   |     |   | | | |   | |       |     | |   |   | |   |   |         |       |   |       |     | |   |     | |     | | | |   | | | | | | 
 +---|-|---|-|-|-|-|---------|-------|-----------------|-----|---------------+ | | |   | |       |     | |   |   +-|---+   |         +-----------|-------|-----|---------+ | +---------|-------|-|-+ | | 
 |   | | | | | | | | | |     |       |           |     |     | |   |     |     | | |   | |       |     | |   |     |       |                 |   |       |     | |   |   | |       | | | |   | | |   | | 
 |   | | | | | | | | | |     |       |           |     |     | |   |     |     | | |   | |       |     | |   |     |       |                 +-----------|-+   | |   |   | |       | | | |   | | |   | | 
 |   | | | | | | | | | |     |       |           |     |     | |   |     |     | | |   | |       |     | |   |     |       |                     |       | |   | |   |   | |       | | | |   | | |   | | 
 |   | | | | | | | | | |     |       |           |     |     | |   |     | +---|-|-------|-------|-----|-+   |     |       |                     |       | |   | |   |   | |       | | | |   | | |   | | 
 |   | | | | | | | | | |     |       |           |     |     | |   |     | |   | | |   | |       |     |     |     |       |                     |       | |   | |   |   | |       | | | |   | | |   | | 
 |   | | | | | | | | | |     |       |           |     |     | |   |     | |   | | |   | |       |     |     |     |       |         +-------------------|-|---------|-----------------|-|-------|-+ | | 
 |   | | | | | | | | | |     |       |           |     |     | |   |     | |   | | |   | |       |     |     |     |       |         |           |       | |   | |   |   | |       | | | |   | | | | | | 
 |   | | | | | | | | | |     |     +-------------------|-----|-------------|-------|-------------|-----|-----|-----------------------|-----------|-------|-|-----|-------|-|-----+ | | | |   | | | | +-+ 
 |   | | | | | | | | | |     |     | |           |     |     | |   |     | |   | | |   | |       |     |     |     |       |         |           |       | |   | |   |   | |     | | | | |   | | | |     
 |   | | | | | | | | | |     |     | |           |     |     | |   |     | +---+ | |   | |       |     |     |     |       |         |           |       | |   | |   |   | |     | | | | |   | | | |     
 |   | | | | | | | | | |     |     | |           |     |     | |   |     |       | |   | |       |     |     |     |       |         |           |       | |   | |   |   | |     | | | | |   | | | |     
 |   | | | | | | | | | |     |     | |           |     |     | |   |     |       | +-----|-------------------|-----------------------------------+       | |   | |   |   | |     | | | | |   | | | |     
 |   | | | | | | | | | |     |     | |           |     |     | |   |     |       |     | |       |     |     |     |       |         |                   | |   | |   |   | |     | | | | |   | | | |     
 |   | | | | | | | | | |     |     | |           |     |     | | +-|-------------|---------------|-----------|-----|---------------+ |                   | |   | |   |   | |     | | | | |   | | | |     
 |   | | | | | | | | | |     |     | |           |     |     | | | |     |       |     | |       |     |     |     |       |       | |                   | |   | |   |   | |     | | | | |   | | | |     
 |   | | | | | | | | | |     |     | |           |     |     | | | +-----+       |     | |       |     |     |   +-|-----------+   | |               +-----|---|-----+   | |     | | | | |   | | | |     
 |   | | | | | | | | | |     |     | |           |     |     | | |               |     | |       |     |     |   | |       |   |   | |               |   | |   | |       | |     | | | | |   | | | |     
 |   | +---------|-----------|-------|-----------------|---+ | | |               |     | |       |     |     |   | |       |   |   | |   +---------------|-|---|---------|-|-+   | +-+ | |   | | | |     
 |   |   | | | | | | | |     |     | |           |     |   | | | |               |     | |       |     |     |   | |       |   |   | |   |           |   | |   | |       | | |   |     | |   | | | |     
 |   |   | | | | +-----|-----------|-----------------------|-|---|-------+       |     | |       |     |     |   | |       |   |   | |   |           |   | +---|-|-------|-------------|-----------|-+   
 |   |   | | | |   | | |     |     | |           |     |   | | | |       |       |     | |       |     |     |   | |       |   |   | |   |           |   |     | |       | | |   |     | |   | | | | |   
 |   |   | | | |   | | |     |     | |           |     |   | | | |       |       |     | |       |     |     +-----|-----------|---|---------------------------+ |       | | |   |     | |   | | | | |   
 |   |   | | | |   | | |     |     | |           |     |   | | | |       |       |     | |       |     |         | |       |   |   | |   |           |   |       |       | | |   |     | |   | | | | |   
 |   |   | | | |   | | |     |     | |           |     |   | | | |       |       |     | |       |     |         | |       |   |   | |   |           |   |       |       | | |   |     | |   | | | | |   
 |   |   | | | |   | | |     |     | |           |     |   | | | |       |       |     | |       |     |         | |       |   |   | |   |           |   |       |       | | |   |     | |   | | | | |   
 |   | +---|---|-------------|-----|---------------------------+ |       |       |     | |       |     |         | |       |   |   | |   |           |   |       |       | | |   |     | |   | | | | |   
 |   | | | | | |   | | |     |     | |           |     |   | |   |       |       |     | |       |     |         | |       |   |   | |   |           |   |       |       | | |   |     | |   | | | | |   
 |   | | | | | |   | | |     |     | |           |     |   | |   |       |       |     | |       |     |         | |       |   |   | |   |           |   |       |       | | |   |     | |   | | | | |   
 |   | | | | | |   | | |     |     | |           |     |   | |   |       |       |     | |       |     |         | |       |   |   | |   |           |   |       |       | | |   |     | |   | | | | |   
 |   | | | | | |   | | |     |     | |           |     |   | |   |     +-|-------|-------|-------------+         | |       |   |   | |   |           |   |       |       | | |   | +---|-|---|---|---+   
 |   | | | | | |   | | |     |     | |           |     |   | |   |     | |       |     | |       |               | |       |   |   | |   |           |   |       |       | | |   | |   | |   | | | |     
 |   | | | | | |   | | |     |     | |           |     |   | +---------|---------------|-|-------|---------------|-------------------|---+           |   |       |       | | |   | |   | |   | | | |     
 |   | | | | | |   | | |     |     | |           |     |   |     |     | |       |     | |       |               | |       |   |   | |               |   |       |       | | |   | |   | |   | | | |     
 |   | | | | | |   | | |     |   +--------L------------|-----+   |     | +-+     |     | |       |               +---------|---|---------------------------------|---------+ |   | |   | |   | | | |     
 |   | | | | | |   | | |     |   | | |           |     |   | |   |     |   |     |     | |       |                 |       |   |   | |               |   |       |       |   |   | |   | |   | | | |     
 | +-|-|-|-|-|-----|---|-----|---|-|-+           +---------|-----|---------------|-----|---------|-----------------|-----------+   | |               |   |       |       |   |   | |   | |   | | | |     
 | | | | | | | |   | | |     |   | |                   |   | |   |     |   |     |     | |       |                 |       |       | |               |   |       |       |   |   | |   | |   | | | |     
 | | +-|-----|-----+ | |     |   | | +-------+         |   | |   |     |   |     |     | |       |                 |       |       | |               |   |       |       |   |   | |   | |   | | | |     
 | |   | | | | |     | |     |   | | |       |         |   | |   |     |   |     |     | |       |                 |       |       | |               |   |       |       |   |   | |   | |   | | | |     
 | +-----+ | | | +-----|-----|---|---|---------------------|---------------|-----|-------|-------|-----------------|-------|-------+ |               |   |       |       |   |   | |   | |   | | | |     
 |     |   | | | |   | |     |   | | |       |         |   | |   |     |   |     |     | |       |                 |       |         |               |   |       |       |   |   | |   | |   | | | |     
 |     |   | | | |   | | +---|-----+ +-------|---------|-----|---------+   |     |     | |       |                 |       |         |               |   |       |       |   |   | |   | |   | | | |     
 |     |   | | | |   | | |   |   |           |         |   | |   |         |     |     | |       |                 |       |         |               |   |       |       |   |   | |   | |   | | | |     
 | +-------+ | | |   | | |   |   +-----+     |         |   | |   |     +---|-----------|---------|-----------------------------------|-------------------|-------+       |   |   | |   | |   | | | |     
 | |   |     | | |   | | |   |         |     |         |   | |   |     |   |     |     | |       |                 |       |         |               |   |               |   |   | |   | |   | | | |     
 | |   |     | | |   | | |   |         |     |         |   | |   |     |   |     |     | |       |                 |       |         |               |   |               |   |   | |   | |   | | | |     
 | |   |     | | |   | | |   |         |     |         |   | |   |     |   |     |     | |       |                 |       |         |               |   |               |   |   | |   | |   | | | |     
 | |   |     | | |   | | |   |         |     |         |   | |   |     |   |     |     | |       |       +-----------------|---------|-------------------|-------------------|-+ | |   | |   | | | |     
 | |   |     | | |   | | |   |         |     |         |   | |   |     |   |     |     | |       |       |         |       |         |               |   |               |   | | | |   | |   | | | |     
 | |   |     | | |   | | |   |     +---|---------------|---|-----------|-------+ |     | |       |       |         |       |         |               |   |           +-----+ | | | |   | |   | | | |     
 | |   |     | | |   | | |   |     |   |     |         |   | |   |     |   |   | |     | |       |       |         |       |         |               |   |           |   | | | | | |   | |   | | | |     
 +-----------|-|-----|-|-----|---------|-----|-------------------|-----|---|-----------|-|---------------|---------|-------|-----------------------------|---------------+ | | | | |   | |   | +-----+   
   |   |     | | |   | | |   |     |   |     |         |   | |   |     |   |   | |     | |       |       |         |       |         |               |   |           |     | | | | |   | |   |   | | |   
   |   |     | | |   | | |   |     |   |     |         |   | |   |     |   |   | |     | |       |       |         |       |         |               |   |           |     | | | | |   | |   |   | | |   
   |   |     | | |   | | |   |     |   |     |         |   | |   |     |   |   | |     | |       |       |         |       |         |               |   |           |     | | | | |   | |   |   | | |   
   |   |     | | |   | | |   |     |   |     |         |   | |   |     |   |   | |     | |       |       |         |       |         |               |   |           |     | | | | |   | |   |   | | |   
   |   |     | | |   | | |   |     |   |     |         |   | |   |     |   |   | |     | |       |       |         |       |         |               |   |           |     | | | | |   | |   |   | | |   
 +-+   |     | +-+   | | |   |     |   |     |         |   | |   |     |   |   | +-----------------------|-----------------|-----------------------------------------------+ | | | |   | |   |   | | |   
 |     |     |       | | |   |     |   |     |         |   | |   |     |   |   |       | |       |       |         |       |         |               |   |           |       | | | |   | |   |   | | |   
 | +---+     |       | | |   |     |   |     |         |   | |   |     |   |   |       | |       |       |         |       |         |               |   |           |       | | | |   | |   |   | | |   
 | |         |       | | |   |     |   |     |         |   | |   |     |   |   |       | |       |       |         |       |         |               |   |           |       | | | |   | |   |   | | |   
 | +-------+ +---+   +-|-------+   |   |     |         |   | |   |     |   |   |       | |       |       |         |       |         |               |   +-+         |       | | | |   | |   |   | | |   
 |         |     |     | |   | |   |   |     |         |   | |   |     |   |   |       | |       |       |         |       |         |               |     |         |       | | | |   | |   |   | | |   
 |         +-----|-------|-------------|-----|-------------|-----|---------|-----------|-|---------------+         +-+     |         +---------------------|---------------------|-+   | |   |   | | |   
 |               |     | |   | |   |   |     |         |   | |   |     |   |   |       | |       |                   |     |                         |     |         |       | | |     | |   |   | | |   
 |             +-------+ |   | |   |   |     |         |   +-----|-----|---------------------------------------------|-----|-----------------+   +-------------------+     +-----+     | |   |   | | |   
 |             | |       |   | |   |   |     |         |     |   |     |   |   |       | |       |                   |     |                 |   |   |     |               | | |       | |   |   | | |   
 |     +-------+ |   +---|---|-|---|-----+   |         |     |   |     |   |   |       | |       |                   +-----+                 |   |   |     |               | | |       | |   +-+ | | |   
 |     |         |   |   |   | |   |   | |   |         |     |   |     |   |   |       | |       |                                           |   |   |     |               | | |       | |     | | | |   
 |     |       +-----+ +-----------------|---|-----------------------------|-----------|-----------------------------------------------------+   |   |     |               | | |       | |     | | | |   
 |     |       | |     | |   | |   |   | |   |         |     |   |     |   |   |       | |       |                                               |   |     |               | | |       | |     | | | |   
 |     |       | +-----+ |   | |   |   | |   |         |     |   |     |   |   |       | |       |                                   +-----------+   +---+ |               | | |       | |     | | | |   
 |     |       |         |   | |   |   | |   |         |     |   |     |   |   |       | |       |                                   |                   | |               | | |       | |     | | | |   
 +-------------+ +-----U +---------|---+ |   |         |     |   |     |   |   | +---------------------------------------------------|-------------------+ +---------------+ | |       | |     | | | |   
       |         |           | |   |     |   |         |     |   |     |   |   | |     | |       |                                   |                                       | |       | |     | | | |   
       |   +-----------------+ |   |     |   |         |     |   |     |   |   | |     | | +-----------------------------------------|---------------------------------------+ |       | |     | | | |   
       |   |     |             |   |     |   |         |     |   |     |   |   | |     | | |     |                                   |                                         |       | |     | | | |   
   +---+   |     +-----------------|-+   +---|---------|-----|---|-------------|-----+ | | +-----|-----------------------------------|---------------------------------------+ +-+     | |     +---+ +-+ 
   |       |                   |   | |       |         |     |   |     |   |   | |   | | |       |                                   |                                       |   |     | |       |     | 
 +---------+ +-----------------+   | +---+   |   +-----------+   +---------------+ +-+ +-|-+     | +-----------------------------------------------------------------------------------|-|-------|-----+ 
 | |         |                     |     |   |   |     |               |   |   |   |     | |     | |                                 |                                       |   |     | |       |       
 | +---+   +-|-------------------------------|-----------------------------|-------|-------------+ |                 +-------------------------------------------------------+ +-+     | |       |       
 |     |   | |                     |     |   |   |     |               |   |   |   |     | |       |                 |               |                                         |       | |       |       
 +---------+ +---------------------|-+   +---+   +-------------------------+   |   |     +-|-------|-----------------+               +-----------------------------------------+       | |       +-+     
       |                           | |                 |               |       |   |       |       |                                                                                   | |         |     
       +---------------------------+ +-----------------+               +-------+   +-------+       +-----------------------------------------------------------------------------------+ +---------+     
EOM

require 'matrix'
rows = []
@input.split("\n").each do |line|
  rows << line.split('')
end

@matrix = Matrix.rows rows
@current_position = [0,173]
@current_direction = :down


@seen_letters = []

def try_left
  if @current_position[1]-1 < 0
    false
  elsif ![nil, ' ', '+'].include? @matrix[@current_position[0],@current_position[1]-1]
    @current_position = [@current_position[0],@current_position[1]-1]
    @seen_letters << @matrix[@current_position[0],@current_position[1]-1]
    @current_direction = :left
    true
  else
    false
  end
end

def try_right
  if ![nil, ' ', '+'].include? @matrix[@current_position[0],@current_position[1]+1]
    @current_position = [@current_position[0],@current_position[1]+1]
    @seen_letters << @matrix[@current_position[0],@current_position[1]+1]
    @current_direction = :right
    true
  else
    false
  end
end

def try_up
  if @current_position[0]-1 < 0
    false
  elsif ![nil, ' ', '+'].include? @matrix[@current_position[0]-1,@current_position[1]]
    @current_position = [@current_position[0]-1,@current_position[1]]
    @seen_letters << @matrix[@current_position[0]-1,@current_position[1]]
    @current_direction = :up
    true
  else
    false
  end
end

def try_down
  if ![nil, ' ', '+'].include? @matrix[@current_position[0]+1,@current_position[1]]
    @current_position = [@current_position[0]+1,@current_position[1]]
    @seen_letters << @matrix[@current_position[0]+1,@current_position[1]]
    @current_direction = :down
    true
  else
    false
  end
end

def move
  case @current_direction
  when :down
    if ![' ', nil, '+'].include? @matrix[@current_position[0]+1,@current_position[1]]
      @current_position = [@current_position[0]+1,@current_position[1]]
      @seen_letters << @matrix[@current_position[0]+1,@current_position[1]]
    elsif @matrix[@current_position[0]+1,@current_position[1]] == '+'
      @current_position = [@current_position[0]+1,@current_position[1]]
      @seen_letters << @matrix[@current_position[0]-1,@current_position[1]]
      try_left || try_right
    else
      try_left || try_right
    end
  when :left
    if @current_position[1]-1<0
      try_up || try_down
    end
    if ![' ', nil, '+'].include? @matrix[@current_position[0],@current_position[1]-1]
      @current_position = [@current_position[0],@current_position[1]-1]
      @seen_letters << @matrix[@current_position[0],@current_position[1]-1]
    elsif @matrix[@current_position[0],@current_position[1]-1] == '+'
      @current_position = [@current_position[0],@current_position[1]-1]
      @seen_letters << @matrix[@current_position[0]-1,@current_position[1]]
      try_up || try_down
    else
      try_up || try_down
    end
  when :right
    if ![' ', nil, '+'].include? @matrix[@current_position[0],@current_position[1]+1]
      @current_position = [@current_position[0],@current_position[1]+1]
      @seen_letters << @matrix[@current_position[0],@current_position[1]+1]
    elsif @matrix[@current_position[0],@current_position[1]+1] == '+'
      @current_position = [@current_position[0],@current_position[1]+1]
      @seen_letters << @matrix[@current_position[0]-1,@current_position[1]]
      try_down || try_up
    else
      try_down || try_up
    end
  when :up
    if @current_position[0]-1 <0
      try_left || try_right
    end
    if ![' ', nil, '+'].include? @matrix[@current_position[0]-1,@current_position[1]]
      @current_position = [@current_position[0]-1,@current_position[1]]
      @seen_letters << @matrix[@current_position[0]-1,@current_position[1]]
    elsif @matrix[@current_position[0]-1,@current_position[1]] == '+'
      @current_position = [@current_position[0]-1,@current_position[1]]
      @seen_letters << @matrix[@current_position[0]-1,@current_position[1]]
      try_left || try_right
    else
      try_left || try_right
    end
  end
end

until @current_position == [187, 23]
  move
  # sleep 0.1
  puts @current_direction
  puts @current_position.inspect
end

 @seen_letters.uniq.join()
 #=> "|-+QPRYCIOLU "
#QPRYCIOLU

@seen_letters.size +1
# 15704
# 16160 too low
# 16161 too low
# 16162 answer